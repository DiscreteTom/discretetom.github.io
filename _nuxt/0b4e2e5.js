(window.webpackJsonp=window.webpackJsonp||[]).push([[104,368],{1310:function(t,n,e){const r={render:function(){var t=this;t.$createElement;return t._self._c,t._m(0)},staticRenderFns:[function(){var t=this,n=t.$createElement,r=t._self._c||n;return r("div",{staticClass:"frontmatter-markdown"},[r("h2",{attrs:{id:"前言"}},[t._v("前言")]),t._v(" "),r("p",[t._v("最近学习了不少游戏客户端架构相关的东西，包括"),r("a",{attrs:{href:"https://www.bilibili.com/video/BV1JB4y1S7hk"}},[t._v("此视频")]),t._v("，"),r("a",{attrs:{href:"https://www.bilibili.com/video/BV1vg411g7Fn"}},[t._v("此视频")]),t._v("和"),r("a",{attrs:{href:"https://www.bilibili.com/video/BV1Wi4y157cE"}},[t._v("此视频")])]),t._v(" "),r("p",[t._v("不同大佬的核心目标都是一样的：构建高内聚、低耦合的游戏客户端代码，使大型项目的开发更加可控，提高业务逻辑的可扩展性等。")]),t._v(" "),r("p",[t._v("但是不同大佬的实现方式是不一样的，使用的工具也不一样。")]),t._v(" "),r("p",[t._v("我想基于我自己的需求和场景，结合各位大佬的设计思路，提出自己的客户端架构设计哲学。所以就有了本文。所以核心目标都是一样的，只是代码规范/实现规范不同。")]),t._v(" "),r("p",[t._v("以下便是我提出的设计规范，欢迎讨论。")]),t._v(" "),r("h2",{attrs:{id:"架构图"}},[t._v("架构图")]),t._v(" "),r("p",[r("img",{attrs:{src:e(485),alt:"Architecture"}})]),t._v(" "),r("h2",{attrs:{id:"操作流"}},[t._v("操作流")]),t._v(" "),r("h3",{attrs:{id:"程序初始化"}},[t._v("程序初始化")]),t._v(" "),r("p",[t._v("虽然 App 是 Scene 中唯一顶层 GameObject，但是 Unity3D 中的 Start 函数调用顺序是随机的。为了确保 Core 可以被 App 创建，然后再被其他 Controller 调用，需要在 App 的 Awake 函数中初始化 Core，其他 Controller 可以在 Start 函数中访问 Core")]),t._v(" "),r("h3",{attrs:{id:"业务逻辑与表现的分离团队合作"}},[t._v("业务逻辑与表现的分离，团队合作")]),t._v(" "),r("p",[t._v("业务逻辑基本都在 Core 里面进行。Controller 通过 Command 触发业务逻辑，Core 通过 Event 通知 Controller 更新视图")]),t._v(" "),r("p",[t._v("这样，在团队分工合作中，可以由程序员 A 编写 Command/Events，由程序员 B 实现 View/Controller。只要接口（也就是 Command/Events）被定义好即可")]),t._v(" "),r("h3",{attrs:{id:"解耦"}},[t._v("解耦")]),t._v(" "),r("ul",[r("li",[t._v("Controller 之间也是互相不可知的，只能通过 Command / Event 进行交互")]),t._v(" "),r("li",[t._v("App 也不知道 Controller 的存在，只能通过 Command / Event 进行操作")]),t._v(" "),r("li",[t._v("App / Controller 都知道 Core 的存在，都只和 Core 交互")])]),t._v(" "),r("h2",{attrs:{id:"app"}},[t._v("APP")]),t._v(" "),r("p",[t._v("示例：")]),t._v(" "),r("pre",{staticClass:"language-cs"},[r("code",{pre:!0,attrs:{class:"language-cs"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventBus")]),t._v(" eBus"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommandBus")]),t._v(" cBus"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Config")]),t._v(" config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("App")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MonoBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core")]),t._v(" core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Awake")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// init core")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Core")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("h2",{attrs:{id:"core"}},[t._v("Core")]),t._v(" "),r("h3",{attrs:{id:"禁止单例"}},[t._v("禁止单例")]),t._v(" "),r("p",[t._v("单例的坏处：")]),t._v(" "),r("ul",[r("li",[t._v("单例可以被全局访问，无法规范化访问控制，导致引用关系复杂")]),t._v(" "),r("li",[t._v("单例只能创建一个。当我们需要扩展功能的时候（比如：单个玩家变为两个玩家），可能要大改")])]),t._v(" "),r("p",[t._v("原则：")]),t._v(" "),r("ul",[r("li",[t._v("除非你特别确定，否则不要在任何地方使用单例、静态类")]),t._v(" "),r("li",[t._v("使用可以被实例化的类（可以被 new 出来的类），替代单例")]),t._v(" "),r("li",[t._v("使用上文的 APP，在程序入口处创建这些对象，保存在 Core 里面")])]),t._v(" "),r("h3",{attrs:{id:"scriptableobject"}},[t._v("ScriptableObject")]),t._v(" "),r("p",[t._v("直接在 Scene 里面通过 MonoBehaviour 中的 public 变量，或 SerializeField 变量，实现修改变量或拖拽绑定，本身就是不稳定，并且难以查询和管理的。多人编辑同一个 Scene 也难以实现版本控制")]),t._v(" "),r("p",[t._v("所以，这些需要在编辑器修改的变量，建议创建 ScriptableObject，以文件的形式保存这些数据（就像保存了一个 JSON 文件，但是可以在编辑器里面修改），同时这些数据还可以被多次引用")]),t._v(" "),r("p",[t._v("当这些数据需要被使用时，也不要通过拖拽绑定。可以使用 Addressables 等资源管理插件，在代码里面获取资源。Code is Law，代码里面的才是最持久的")]),t._v(" "),r("p",[t._v("因为 ScriptableObject 自身是模块化的，不会随着 Scene 改变，可以进行细粒度的版本控制，所以可以在 ScriptableObject 里面进行拖拽绑定")]),t._v(" "),r("p",[t._v("初始化时需要的数据，可以在 APP 的 Start 里面进行获取")]),t._v(" "),r("p",[t._v("示例：")]),t._v(" "),r("pre",{staticClass:"language-cs"},[r("code",{pre:!0,attrs:{class:"language-cs"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("App")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MonoBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core")]),t._v(" core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Awake")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// construct core")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Core")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sync fetch")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Addressables"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token generic-method"}},[r("span",{pre:!0,attrs:{class:"token function"}},[t._v("LoadAssetAsync")]),r("span",{pre:!0,attrs:{class:"token generic class-name"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Assets/Config.asset"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("WaitForCompletion")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("h3",{attrs:{id:"响应式"}},[t._v("响应式")]),t._v(" "),r("p",[t._v("有时我们可能希望观察 Model 中的数据变化，从而修改视图")]),t._v(" "),r("p",[t._v("可以实现一个简单的 Watch 类")]),t._v(" "),r("pre",{staticClass:"language-cs"},[r("code",{pre:!0,attrs:{class:"language-cs"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watch"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnityEvent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" onChange"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Watch")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onChange "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("UnityEvent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("T")]),t._v(" Value "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" old "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onChange"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" old"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnityAction"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" f"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onChange"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("RemoveListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnityAction"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" f"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onChange"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("RemoveListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("p",[t._v("这样就可以创建响应式 Model")]),t._v(" "),r("pre",{staticClass:"language-cs"},[r("code",{pre:!0,attrs:{class:"language-cs"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Model")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Watch"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" Score "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Model")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Score "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Watch"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("p",[t._v("赋值和监听：")]),t._v(" "),r("pre",{staticClass:"language-cs"},[r("code",{pre:!0,attrs:{class:"language-cs"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SomeController")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MonoBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" core "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GameObject"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Find")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"App"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token generic-method"}},[r("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetComponent")]),r("span",{pre:!0,attrs:{class:"token generic class-name"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("App"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// assignment")]),t._v("\n    core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Score"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// watch for changes")]),t._v("\n    core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Score"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" old"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Debug"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Log")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("p",[t._v("如果不想自己实现 Watch，可以直接使用"),r("a",{attrs:{href:"https://github.com/DiscreteTom/unity3d-utils/tree/main/General/Watch"}},[t._v("这里的代码片段")])]),t._v(" "),r("h3",{attrs:{id:"事件消息"}},[t._v("事件/消息")]),t._v(" "),r("p",[t._v("可以在 Core 中保存一个全局使用的 EventBus。当然，也不能是单例/静态类")]),t._v(" "),r("p",[t._v("示例：")]),t._v(" "),r("pre",{staticClass:"language-cs"},[r("code",{pre:!0,attrs:{class:"language-cs"}},[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sample events")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Events")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UnityEvent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" SomeEvent "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("UnityEvent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("App")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MonoBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Awake")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Events "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Events")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create event bus")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SomeController")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MonoBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" core "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GameObject"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Find")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"App"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token generic-method"}},[r("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetComponent")]),r("span",{pre:!0,attrs:{class:"token generic class-name"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("App"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// watch events")]),t._v("\n    core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Events"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SomeEvent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// trigger events")]),t._v("\n    core"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Events"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SomeEvent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Invoke")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("p",[t._v("如果不想自己实现 EventBus，可以直接使用"),r("a",{attrs:{href:"https://github.com/DiscreteTom/unity3d-utils/tree/main/General/EventBus"}},[t._v("这里的代码片段")])]),t._v(" "),r("h2",{attrs:{id:"controllers"}},[t._v("Controllers")]),t._v(" "),r("h3",{attrs:{id:"原则"}},[t._v("原则")]),t._v(" "),r("ul",[r("li",[t._v("Controller 可以通过 App 获得 Core")]),t._v(" "),r("li",[t._v("Controller 之间是互相无法感知的，需要通过 Core 进行 Controller 之间的交互")])]),t._v(" "),r("p",[t._v("上面已经有一些 Controller 的示例了。如果要更好得结合 App 和 Controller，可以参考我实现的 "),r("a",{attrs:{href:"https://github.com/DiscreteTom/unity3d-utils/tree/main/General/Framework"}},[t._v("Framework 库")])]),t._v(" "),r("h3",{attrs:{id:"获取-core"}},[t._v("获取 Core")]),t._v(" "),r("p",[t._v("因为 Core 是 App 创建的，所以 Controller 需要额外的操作才能获取到 Core")]),t._v(" "),r("p",[t._v("在上面的例子中，我们使用"),r("code",{pre:!0},[t._v('GameObject.Find("App").GetComponent<App>().core')]),t._v("的方式获取 core。如果确保 App 是 Scene 里面的根元素，也可以使用"),r("code",{pre:!0},[t._v("transform.root.GetComponent<App>().core")]),t._v("等方式获取 Core")]),t._v(" "),r("p",[t._v("因为业务逻辑会频繁使用 Core，所以建议在 "),r("code",{pre:!0},[t._v("Start")]),t._v(" 函数中获取 Core 并保存为成员变量（除非使用下文提到的 Composable 思路）")]),t._v(" "),r("h3",{attrs:{id:"composable"}},[t._v("Composable")]),t._v(" "),r("p",[t._v("我实现的 "),r("a",{attrs:{href:"https://github.com/DiscreteTom/unity3d-utils/tree/main/General/Framework"}},[t._v("Framework 库")]),t._v("中，Controller 继承了 "),r("code",{pre:!0},[t._v("ComposableBehaviour")])]),t._v(" "),r("p",[r("code",{pre:!0},[t._v("ComposableBehaviour")]),t._v(" 的功能是提供了 "),r("code",{pre:!0},[t._v("OnUpdate")]),t._v(" 等函数，并禁用了 "),r("code",{pre:!0},[t._v("Update")]),t._v(" 函数，所以所有业务逻辑都可以在 "),r("code",{pre:!0},[t._v("Start")]),t._v(" 函数中实现")]),t._v(" "),r("pre",{staticClass:"language-cs"},[r("code",{pre:!0,attrs:{class:"language-cs"}},[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传统写法")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MonoBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Update")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用ComposableBehaviour")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("B")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ComposableBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OnUpdate"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("p",[t._v("之所以这么设计，是受到前端框架 vue 3.x 的影响，尝试把业务逻辑相近的变量和函数写到物理距离更近的位置:")]),t._v(" "),r("pre",{staticClass:"language-cs"},[r("code",{pre:!0,attrs:{class:"language-cs"}},[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传统写法")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MonoBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务逻辑A")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" a"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务逻辑B")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" b"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务逻辑A")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务逻辑B")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Update")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务逻辑A")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务逻辑B")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用ComposableBehaviour")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("B")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token type-list"}},[r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ComposableBehaviour")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token return-type class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务逻辑A")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" a "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OnUpdate"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 业务逻辑B")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token class-name"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" b "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OnUpdate"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddListener")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token range operator"}},[t._v("..")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),r("p",[t._v("可以看到，使用 ComposableBehaviour，可以使业务逻辑更加紧凑，而不是分散在多个函数中。同时，通过闭包捕获上下文的变量，可以减少成员变量的使用，减少代码量")])])}]};t.exports={attributes:{title:"游戏客户端架构设计思路",description:"统一入口、MVC、分层等",tags:["Gaming / 游戏","Unity3D"]},vue:{render:r.render,staticRenderFns:r.staticRenderFns,component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=r.render,this.$options.staticRenderFns=r.staticRenderFns}}}}},485:function(t,n,e){t.exports=e.p+"img/47-1.f6b1765.png"}}]);