(window.webpackJsonp=window.webpackJsonp||[]).push([[49,557,558,559,560,561,562],{1324:function(t,e,r){const _={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"frontmatter-markdown"},[r("h2",{attrs:{id:"storage-access"}},[t._v("Storage Access")]),t._v(" "),r("p",[t._v("数据库文件被分为固定长度的块blocks。块是数据库存储与数据传输的单位")]),t._v(" "),r("p",[t._v("DBMS会尽量减少数据传输时的块的数量(主存和外存之间)")]),t._v(" "),t._m(0),t._v(" "),r("h2",{attrs:{id:"buffer-manager"}},[t._v("buffer manager")]),t._v(" "),r("p",[t._v("如果访问的目标块不在buffer")]),t._v(" "),t._m(1),t._v(" "),r("h2",{attrs:{id:"文件组织"}},[t._v("文件组织")]),t._v(" "),r("p",[t._v("数据库database是文件file的集合，文件是记录record的集合，记录是域field的集合")]),t._v(" "),r("p",[t._v("下文中文件也称为操作系统中的块block或页page")]),t._v(" "),r("h3",{attrs:{id:"定长记录"}},[t._v("定长记录")]),t._v(" "),r("p",[t._v("fixed-length record")]),t._v(" "),r("p",[t._v("长度为n的第i个记录起始位置为 "),r("mjx-container",{staticClass:"MathJax",staticStyle:{direction:"ltr"},attrs:{jax:"SVG"}},[r("svg",{staticStyle:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"9.932ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 4389.9 1000"}},[r("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"}},[r("g",{attrs:{"data-mml-node":"math"}},[r("g",{attrs:{"data-mml-node":"mi"}},[r("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"1D45B",d:"M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"}})]),r("g",{attrs:{"data-mml-node":"mo",transform:"translate(822.2,0)"}},[r("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"2217",d:"M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"}})]),r("g",{attrs:{"data-mml-node":"mo",transform:"translate(1544.4,0)"}},[r("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"28",d:"M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"}})]),r("g",{attrs:{"data-mml-node":"mi",transform:"translate(1933.4,0)"}},[r("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"}})]),r("g",{attrs:{"data-mml-node":"mo",transform:"translate(2500.7,0)"}},[r("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"2212",d:"M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"}})]),r("g",{attrs:{"data-mml-node":"mn",transform:"translate(3500.9,0)"}},[r("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"31",d:"M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"}})]),r("g",{attrs:{"data-mml-node":"mo",transform:"translate(4000.9,0)"}},[r("path",{staticStyle:{"stroke-width":"3"},attrs:{"data-c":"29",d:"M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"}})])])])])])],1),t._v(" "),r("p",[t._v("优化：不允许跨块存储")]),t._v(" "),r("p",[t._v("删除第i个记录的策略：")]),t._v(" "),t._m(2),t._v(" "),r("p",[t._v("free list:")]),t._v(" "),t._m(3),t._v(" "),r("h3",{attrs:{id:"变长记录"}},[t._v("变长记录")]),t._v(" "),r("p",[t._v("variable-length record")]),t._v(" "),r("p",[t._v("存储方式：")]),t._v(" "),t._m(4),t._v(" "),r("p",[t._v("困难：难于添加与删除")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),r("p",[t._v("记录的信息有：")]),t._v(" "),t._m(7),t._v(" "),r("p",[t._v("页中添加记录时，左侧记录入口数组向右增长，右侧记录数据向左增长。删除记录时重排列右侧记录数据，保证右侧记录数据连续")]),t._v(" "),r("p",[t._v("记录可以在同一个页中改变位置（当然要刷新他们的入口")]),t._v(" "),r("p",[t._v("外界访问页中的记录时返回他们的入口而不是他们的地址（多一层以保证低耦合")]),t._v(" "),r("h2",{attrs:{id:"管理文件中的记录"}},[t._v("管理文件中的记录")]),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),r("h3",{attrs:{id:"顺序文件组织"}},[t._v("顺序文件组织")]),t._v(" "),r("p",[t._v("适用于顺序处理整个文件的场合")]),t._v(" "),r("p",[t._v("删除使用空闲链表")]),t._v(" "),r("p",[t._v("插入，定位插入目标位置：")]),t._v(" "),t._m(10),t._v(" "),r("p",[t._v("两种情况都要更新链表")]),t._v(" "),t._m(11),t._v(" "),r("h3",{attrs:{id:"多表聚簇文件组织"}},[t._v("多表聚簇文件组织")]),t._v(" "),r("p",[t._v("不同表的数据存在同一个页中")]),t._v(" "),t._m(12),t._v(" "),r("p",[t._v("可以看到属于Comp.Sci的数据被放在了一起，属于Physics的数据被放在了一起。简化了存储")]),t._v(" "),t._m(13),t._v(" "),r("p",[t._v("可以使用链表以提高查询效率")]),t._v(" "),t._m(14),t._v(" "),r("h3",{attrs:{id:"数据字典存储"}},[t._v("数据字典存储")]),t._v(" "),r("p",[t._v("data dictionary storage")]),t._v(" "),r("p",[t._v("数据字典data dict也叫系统目录system catalog，存储元数据metadata，包括：")]),t._v(" "),t._m(15),t._v(" "),r("p",[t._v("数据字典的存储方式可以是：")]),t._v(" "),t._m(16),t._v(" "),t._m(17)])},staticRenderFns:[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("buffer - 主存的一部分，保存一些磁盘块的拷贝")]),t._v(" "),r("li",[t._v("buffer manager - 管理buffer")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ol",[r("li",[t._v("manager在buffer申请空间或移出一些快，然后装入新的块")]),t._v(" "),r("li",[t._v("如果移出的块被更改则会写回磁盘")]),t._v(" "),r("li",[t._v("把buffer中块的地址返回给请求方")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("把i后面所有的记录向前移动(compacting)")]),t._v(" "),r("li",[t._v("把第n个记录覆盖到第i个记录的位置(moving the last record)")]),t._v(" "),r("li",[t._v("使用free list连接所有空闲记录空间")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:r(711),alt:""}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("使用不同的record type")]),t._v(" "),r("li",[t._v("同一个record type，此type允许变长域")]),t._v(" "),r("li",[t._v("支持重复域repeating fields的记录")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",[t._v("使用"),r("strong",[t._v("分槽的页结构slotted page structure")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:r(712),alt:""}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("记录的数量number of record entries")]),t._v(" "),r("li",[t._v("当前页的空闲空间的结束位置end of free space in the block")]),t._v(" "),r("li",[t._v("每个记录的起始位置与大小location and size of each record")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("堆heap - 记录可以放在文件的任何位置")]),t._v(" "),r("li",[t._v("顺序sequential - 顺序存储，使用search key二分查找")]),t._v(" "),r("li",[t._v("哈希hashing - 使用哈希函数定位记录")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",[t._v("通常每个关系（表）的记录用一个单独的文件存储。但是在"),r("strong",[t._v("多表聚簇文件组织multitable clustering file organization")]),t._v("中位于不同关系的记录可以存储在同一个文件中。一个IO操作可以从所有关系中取到相关的记录")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("如果是空闲空间则直接插入")]),t._v(" "),r("li",[t._v("如果不空闲，则插入在超尾位置")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:r(713),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:r(714),alt:""}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("使用一次块的读操作就可以实现连接查询，加速了特定的连接的处理")]),t._v(" "),r("li",[t._v("查询单个表的操作可能会比较麻烦")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:r(715),alt:""}})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("关系的信息\n"),r("ul",[r("li",[t._v("关系名")]),t._v(" "),r("li",[t._v("每个属性的数据类型")]),t._v(" "),r("li",[t._v("视图的定义")]),t._v(" "),r("li",[t._v("完整性约束")])])]),t._v(" "),r("li",[t._v("用户账户信息，密码")]),t._v(" "),r("li",[t._v("统计数据与描述性数据")]),t._v(" "),r("li",[t._v("物理存储信息\n"),r("ul",[r("li",[t._v("存储类型，哈希？顺序？")]),t._v(" "),r("li",[t._v("物理位置，磁盘？文件位置？")])])]),t._v(" "),r("li",[t._v("索引信息")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("自定义文件类型")]),t._v(" "),r("li",[t._v("内置关系（常用）")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:r(716),alt:""}})])}]};t.exports={attributes:{layout:"collection",title:"Storage and File Structure",collection:"DatabaseConcept"},vue:{render:_.render,staticRenderFns:_.staticRenderFns,component:{data:function(){return{templateRender:null}},render:function(t){return this.templateRender?this.templateRender():t("div","Rendering")},created:function(){this.templateRender=_.render,this.$options.staticRenderFns=_.staticRenderFns}}}}},711:function(t,e,r){t.exports=r.p+"img/10-1.f1a3022.png"},712:function(t,e,r){t.exports=r.p+"img/10-2.b9c9160.png"},713:function(t,e,r){t.exports=r.p+"img/10-3.0d58395.png"},714:function(t,e,r){t.exports=r.p+"img/10-4.4311e2f.png"},715:function(t,e,r){t.exports=r.p+"img/10-5.2813a11.png"},716:function(t,e,r){t.exports=r.p+"img/10-6.20f0043.png"}}]);