(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{1103:function(_,v){const e={render:function(){this.$createElement;return this._self._c,this._m(0)},staticRenderFns:[function(){var _=this,v=_.$createElement,e=_._self._c||v;return e("div",{staticClass:"frontmatter-markdown"},[e("h2",{attrs:{id:"前言"}},[_._v("前言")]),_._v(" "),e("p",[_._v("本文是观看"),e("a",{attrs:{href:"https://www.bilibili.com/video/bv164411J761"}},[_._v("此视频")]),_._v("时整理的笔记。")]),_._v(" "),e("h2",{attrs:{id:"ssh"}},[_._v("SSH")]),_._v(" "),e("h3",{attrs:{id:"概述"}},[_._v("概述")]),_._v(" "),e("p",[_._v("安全的远程管理协议。取代了不安全的telnet。telnet使用明文传输包括密码的所有内容，SSH使用密文传输。所以telnet会比ssh快很多")]),_._v(" "),e("p",[_._v("默认使用22端口")]),_._v(" "),e("h3",{attrs:{id:"登陆模式"}},[_._v("登陆模式")]),_._v(" "),e("ul",[e("li",[_._v("口令模式（密码）\n"),e("ul",[e("li",[_._v("登录流程\n"),e("ul",[e("li",[_._v("客户端请求连接")]),_._v(" "),e("li",[_._v("服务器返回公钥\n"),e("ul",[e("li",[_._v("首次登录时，客户端操作人员需要验证服务端公钥的哈希（指纹）是否为服务器公钥的哈希，防止出现中间人攻击")])])]),_._v(" "),e("li",[_._v("客户端使用公钥加密密码，然后发送给服务器")]),_._v(" "),e("li",[_._v("服务器使用私钥解密得到密码，建立连接")])])])])]),_._v(" "),e("li",[_._v("密钥对模式\n"),e("ul",[e("li",[_._v("更安全\n"),e("ul",[e("li",[_._v("密钥对比密码难以人为记忆，可以更有效防止社会工程学攻击")])])]),_._v(" "),e("li",[_._v("优先级高于密码登录")]),_._v(" "),e("li",[_._v("登录流程\n"),e("ul",[e("li",[_._v("客户端请求连接")]),_._v(" "),e("li",[_._v("服务器返回服务端公钥，客户端进行确认")]),_._v(" "),e("li",[_._v("客户端把客户端公钥发给服务器")]),_._v(" "),e("li",[_._v("服务器验证客户端公钥，如果本地有此公钥的记录，则随机生成一段challenge并使用客户端公钥加密，然后返回给客户端")]),_._v(" "),e("li",[_._v("客户端使用客户端私钥解密，然后再把challenge使用服务器公钥加密返回给服务器")]),_._v(" "),e("li",[_._v("服务器使用服务器私钥验证challenge，然后建立连接")])])])])])]),_._v(" "),e("h3",{attrs:{id:"相关命令"}},[_._v("相关命令")]),_._v(" "),e("ul",[e("li",[e("code",{pre:!0},[_._v("ssh [options] <username>@<ip|domain>")]),_._v(" "),e("ul",[e("li",[_._v("如果没有指定用户名，即"),e("code",{pre:!0},[_._v("ssh <ip|domain>")]),_._v("，则默认使用"),e("code",{pre:!0},[_._v("root")]),_._v("用户登录")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("-i <key-file>")]),_._v("指定密钥文件。默认是"),e("code",{pre:!0},[_._v("~/.ssh/id_rsa")]),_._v("、"),e("code",{pre:!0},[_._v("~/.ssh/id_dsa")]),_._v("等")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("-p <port>")]),_._v("指定端口。也可以直接"),e("code",{pre:!0},[_._v("ssh <ip|domain> <port>")])])])]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("ssh-keygen -t rsa -b 2048")]),_._v("生成密钥对\n"),e("ul",[e("li",[e("code",{pre:!0},[_._v("-t <type>")]),_._v("指定加密类型，如"),e("code",{pre:!0},[_._v("rsa")]),_._v("/"),e("code",{pre:!0},[_._v("dsa")]),_._v("。默认"),e("code",{pre:!0},[_._v("rsa")])]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("-b <bits>")]),_._v("指定密钥长度\n"),e("ul",[e("li",[_._v("1024位以内的RSA密钥已经被暴力破解，默认值为3072")])])]),_._v(" "),e("li",[_._v("执行过程会询问\n"),e("ul",[e("li",[_._v("密钥保存位置。默认位置在"),e("code",{pre:!0},[_._v("~/.ssh/")])]),_._v(" "),e("li",[_._v("是否加密密钥文件\n"),e("ul",[e("li",[_._v("如果加密，则调用私钥文件时需要先验证密码")])])])])])])]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("ssh-copy-id <username>@<ip|domain>")]),_._v("把公钥文件上传到服务器。需要输入密码\n"),e("ul",[e("li",[e("code",{pre:!0},[_._v("-i <key-file>")]),_._v("指定密钥文件。默认是"),e("code",{pre:!0},[_._v("~/.ssh/id_rsa")]),_._v("、"),e("code",{pre:!0},[_._v("~/.ssh/id_dsa")]),_._v("等")]),_._v(" "),e("li",[_._v("上传后会修改服务器的"),e("code",{pre:!0},[_._v("~/.ssh/authorized_keys")]),_._v("文件来注册公钥")])])]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("scp <from> <to>")]),_._v("基于ssh的安全文件拷贝\n"),e("ul",[e("li",[_._v("可能较慢。但是不会占用很多系统负荷")]),_._v(" "),e("li",[_._v("默认端口22。可以使用"),e("code",{pre:!0},[_._v("-P <port>")]),_._v("修改")]),_._v(" "),e("li",[_._v("远程主机格式："),e("code",{pre:!0},[_._v("<username>@<ip|domain>:<path>")])])])]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("sftp <username>@<ip|domain>")]),_._v("基于ssh的安全FTP。效率低于FTP\n"),e("ul",[e("li",[e("code",{pre:!0},[_._v("-oPort=1234")]),_._v("指定端口")]),_._v(" "),e("li",[_._v("交互模式命令\n"),e("ul",[e("li",[e("code",{pre:!0},[_._v("help")]),_._v("查看帮助")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("lpwd")]),_._v("/"),e("code",{pre:!0},[_._v("pwd")]),_._v("查看本机/远程主机当前路径")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("lls")]),_._v("/"),e("code",{pre:!0},[_._v("ls")]),_._v("查看本机/远程主机当前路径下的文件")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("lcd")]),_._v("/"),e("code",{pre:!0},[_._v("cd")]),_._v("切换本机/服务器目录")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("put")]),_._v("/"),e("code",{pre:!0},[_._v("get")]),_._v("上传/下载文件")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("rm")]),_._v("删除服务端文件")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("quit")]),_._v("退出")])])])])])]),_._v(" "),e("h3",{attrs:{id:"配置文件"}},[_._v("配置文件")]),_._v(" "),e("p",[e("code",{pre:!0},[_._v("/etc/ssh/sshd_conf")])]),_._v(" "),e("p",[_._v("修改配置文件后需要重启"),e("code",{pre:!0},[_._v("sshd")]),_._v("服务")]),_._v(" "),e("p",[_._v("常用配置：")]),_._v(" "),e("ul",[e("li",[e("code",{pre:!0},[_._v("PasswordAuthentication yes")]),_._v("是否允许使用密码登录")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("PermitRootLogin yes")]),_._v("是否允许root用户登录")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("Port 22")]),_._v("指定端口")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("ListenAddress 192.168.88.100")]),_._v("限制本地监听IP。需要指定本机的网卡IP\n"),e("ul",[e("li",[e("code",{pre:!0},[_._v("0.0.0.0")]),_._v("表示监听所有网卡的所有IP")])])])]),_._v(" "),e("h2",{attrs:{id:"tcp-wrappers"}},[_._v("TCP Wrappers")]),_._v(" "),e("h3",{attrs:{id:"概述-2"}},[_._v("概述")]),_._v(" "),e("p",[_._v("简单防火墙。工作在传输层，对使用TCP连接的某些服务进行访问控制（凡是调用"),e("code",{pre:!0},[_._v("libwrap.so")]),_._v("库文件的程序都会受到控制）")]),_._v(" "),e("h3",{attrs:{id:"判断程序是否受控"}},[_._v("判断程序是否受控")]),_._v(" "),e("p",[_._v("常见受控程序：")]),_._v(" "),e("ul",[e("li",[_._v("sshd")]),_._v(" "),e("li",[_._v("telnet")]),_._v(" "),e("li",[_._v("rpcbind")]),_._v(" "),e("li",[_._v("vsftpd")])]),_._v(" "),e("p",[_._v("判断步骤：")]),_._v(" "),e("ol",[e("li",[_._v("查看服务命令所在位置："),e("code",{pre:!0},[_._v("which sshd")])]),_._v(" "),e("li",[_._v("查看命令是否调用了"),e("code",{pre:!0},[_._v("libwrap.so")]),_._v("文件："),e("code",{pre:!0},[_._v("ldd /usr/sbin/sshd | grep libwrap.so")]),_._v(" "),e("ol",[e("li",[e("code",{pre:!0},[_._v("ldd")]),_._v("命令可以查询某个命令执行时会调用哪些库文件")])])])]),_._v(" "),e("h3",{attrs:{id:"流量过滤流程"}},[_._v("流量过滤流程")]),_._v(" "),e("ol",[e("li",[_._v("服务器接收到TCP请求")]),_._v(" "),e("li",[_._v("IP是否在"),e("code",{pre:!0},[_._v("/etc/hosts.allow")]),_._v("中。如果是，则把TCP请求转发到对应服务")]),_._v(" "),e("li",[_._v("IP是否在"),e("code",{pre:!0},[_._v("/etc/hosts.deny")]),_._v("中。如果是，则拒绝请求")]),_._v(" "),e("li",[_._v("如果上述过程中没有拒绝，则把TCP请求转发到对应服务")])]),_._v(" "),e("h3",{attrs:{id:"配置文件-2"}},[_._v("配置文件")]),_._v(" "),e("p",[e("code",{pre:!0},[_._v("/etc/hosts.allow")]),_._v("和"),e("code",{pre:!0},[_._v("/etc/hosts.deny")])]),_._v(" "),e("p",[_._v("规则格式："),e("code",{pre:!0},[_._v("<service_list>@<host>:<client_list>")])]),_._v(" "),e("ul",[e("li",[e("code",{pre:!0},[_._v("service_list")]),_._v("服务列表，使用"),e("code",{pre:!0},[_._v(",")]),_._v("隔开")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("host")]),_._v("流量从本机哪个网口进入。不写则表示全部")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("client_list")]),_._v("访问者地址。使用"),e("code",{pre:!0},[_._v(",")]),_._v("隔开")]),_._v(" "),e("li",[_._v("支持的格式：\n"),e("ul",[e("li",[_._v("IP地址，如"),e("code",{pre:!0},[_._v("192.168.0.1,192.168.0.2")])]),_._v(" "),e("li",[_._v("主机名，如"),e("code",{pre:!0},[_._v("www.baidu.com,www.bilibili.com")]),_._v("。很少用，因为需要反向解析")]),_._v(" "),e("li",[_._v("CIDR，如"),e("code",{pre:!0},[_._v("192.168.0.0/255.255.255.0")]),_._v("或者不完整的IP地址："),e("code",{pre:!0},[_._v("192.168")]),_._v("。CentOS 7中可以指定前缀长度"),e("code",{pre:!0},[_._v("192.168.0.0/24")])]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("ALL")]),_._v("所有主机")]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("LOCAL")]),_._v("本地主机")])])])]),_._v(" "),e("p",[_._v("示例规则：")]),_._v(" "),e("ul",[e("li",[e("code",{pre:!0},[_._v("sshd:192.168")])]),_._v(" "),e("li",[e("code",{pre:!0},[_._v("sshd:ALL")])])]),_._v(" "),e("p",[_._v("配置文件修改之后不需要重启")])])}]};_.exports={attributes:{title:"Linux Network Applications (Part 2)",description:"SSH, TCP Wrappers"},vue:{render:e.render,staticRenderFns:e.staticRenderFns,component:{data:function(){return{templateRender:null}},render:function(_){return this.templateRender?this.templateRender():_("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}}}]);