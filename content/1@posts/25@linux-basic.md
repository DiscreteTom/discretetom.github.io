---
title: Linux Basic
description: Linux版本分类、磁盘分区、文件系统、系统目录
tags:
  - linux
  - ops
---

## 前言

本文是观看[此视频](https://www.bilibili.com/video/bv1ut411a7ro)时整理的笔记，只记录了我觉得有价值的内容，用来查阅而不是用来学习。不一定适合小白入门Linux。

本文中的Linux系统为CentOS，不同系统在一些细节上会有偏差

本文中的一些描述混合了我的奇妙理解，添加了一些云计算相关知识

有些内容与[大学的笔记](/academic/LinuxProgrammingEnvironment/)重复，建议先看大学的笔记

## Linux版本分类

- 内核版
  - www.kernel.org
- 发行版
  - **RedHat系列**
    - 个人版，有GUI、游戏等一些不需要在服务器上使用的功能
      - Fedora
    - 服务器版
      - RHEL（有些功能收费）
      - **CentOS**
        - 完全照抄RHEL以至于RedHat把它买了
    - 使用RPM管理`rpm`格式的包（RPM包），命令为`rpm`，也可以使用`yum`。[`yum`在RPM系统中添加了自动更新和依赖管理。](https://www.ibm.com/developerworks/cn/linux/l-lpic1-v3-102-5/index.html)
  - Debian系列
    - Debian
    - Ubuntu
      - 常用于教学，但是不适合服务器
    - 使用APT管理`deb`格式的包（DPKG包），命令为`apt`。现在也可以安装RPM包

## 常见开源软件

- Web Server
  - Apache
  - Nginx
- Database
  - MySQL
  - MongoDB
  - Redis
- Script Language
  - PHP
  - Python
  - Ruby
- Linux和Windows之间的内网文件服务器
  - Samba
- 中文分词（用于搜索引擎
  - Sphinx

常见WEB架构：LAMP/LNMP
- Linux
- Apache/Nginx
- MySQL
- PHP/Python

www.netcraft.com可以查看网站使用的后端WEB架构

## 安装Linux

以在虚拟机上安装CentOS为例

### 虚拟机的网络配置

- 桥接
  - 可以连接宿主机
  - 可以访问局域网
  - 可以访问公网
  - 会占用一个局域网IP
- NAT
  - 可以访问宿主机
  - 可以访问公网
- 仅主机
  - 可以访问宿主机

### 磁盘与分区

新硬盘连上电脑之后首先需要进行分区

分区方式（此技术为底层技术，Windows/Linux通用）：

- MBR
  - 每个硬盘最多支持4个分区，包括主分区+扩展分区
  - 最大支持2.1TB的硬盘（多余的空间无法被使用
  - 扩展分区，用来提升分区数量
    - 每个硬盘只能有一个扩展分区
    - 不能写数据，不能格式化，只能包含逻辑分区
    - 逻辑分区数量可以达到10+
    - 逻辑分区的分区号从5开始，主分区/扩展分区的分区号为1-4
- GPT
  - 理论上没有分区数限制。但Windows限制128个分区
  - 最大支持9.4ZB的硬盘

安装新系统时会先要求用户分配磁盘分区给Linux。

- 必需分区
  - 根分区`/`
  - swap分区（交换分区），可以理解为虚拟内存。没有挂载点，无法被用户访问，类型为swap
    - 如果内存小于4GB，swap建议为内存2倍
    - 如果内存大于4GB，swap建议和内存一致
    - 如果磁盘空间够大，swap分区设置大一点没坏处
- 推荐分区
  - `/boot`启动分区，1GB
- 常用分区。相当于是给一些文件夹单独设置分区，而不是作为根分区内的一个文件夹
  - `/home`用于文件服务器
  - `/www`用于WEB服务器

### 文件系统

硬盘分区之后需要格式化分区，用来设置文件系统

文件系统：

- Windows
  - FAT16
  - FAT32
  - NTFS
- Linux
  - EXT2
  - EXT3
  - EXT4
  - XFS

新的文件系统更安全，更快，支持更大的单个文件

Linux中每个文件块(block)默认4KB，可以设置为2KB/1KB。是存储数据的最小单位

每个文件、文件夹都有一个128字节的`inode`，包括
- 文件类型
- 权限
- 大小
- link数
- 时间戳
- 保存位置

inode数量有限，所以如果服务器有过多的空文件，在存储空间耗尽之前，inode会先耗尽

分区之后，windows只需要在磁盘设置中设置盘符就可以使用了。linux需要两步：
- 分配硬件设备文件名（在`/dev`目录中。系统自动分配，不需要手动操作）
  - IDE硬盘（几乎淘汰）：`/dev/hda1`
  - SCSI硬盘/**SATA硬盘**/USB：`/dev/sda1`
    - `sda1`中的`a`表示第一个盘，`1`表示第一个分区
- 挂载(mount)
  - 只能挂载在已经存在且空的目录

### 配置IP地址

RHEL中可以使用`setup`命令配置`ip`。其他系统可以修改配置文件

修改网卡（比如`eth0`）之后可以设置`onboot`为开启状态来保证开机自启

使用`service network restart`来重启网络服务

使用`ifconfig`查看网卡信息。网卡`lo`为环回网卡


> 如果网卡已经设置了onboot但是启动服务器后发现网卡没有启动，可能是网卡UUID冲突导致（比如因为使用了镜像或虚拟机）。
> 解决方案：
> 1. 修改`/etc/sysconfig/network-scripts/ifcfg-eth0`中的MAC地址行。这样服务器就会重新生成MAC地址并计算UUID。
> 2. 删除`/etc/udev/rules.d/70-persistent-net.rules`，此文件记录了MAC地址和UUID的绑定。
> 3. 重启服务器即可获得新的UUID

### 安装系统产生的日志文件

安装后会得到三个日志文件

- install.log - 安装了哪些程序包
- install.log.syslog - 安装程序包的过程中产生的日志，比如新建了哪些用户
- anaconda-ks.cfg - 记录图形化安装时用户的选项，用来实现服务器批量安装

## 常用系统目录

- `/bin`
  - 普通用户就可以执行的命令
  - 是`/usr/bin`的软链接
- `/sbin`
  - 只有超级用户才能执行的命令
  - 是`/usr/sbin`的软链接
- `/boot`
  - 系统启动必备文件，内核文件，引导程序GRUB等，勿动
- `/dev`
  - 设备文件
- `/etc`
  - 配置文件
- `/home`
  - 用户目录
- `/root`
  - 根用户目录
- `/lib`
  - 系统函数库
  - 是`/usr/lib`的软链接
- `/lib64`
  - 64位函数库
  - 是`/usr/lib64`的软链接
- `/lost+found`
  - 系统意外崩溃时恢复文件用的。系统自动执行，无法手动操作
- `/media`
  - 空目录，可以作为光盘挂载点（其实挂载的时候随便找个空目录就行）
- `/misc`
  - 空目录，可以作为网络设备挂载点
- `/mnt`
  - 空目录，可以作为优盘/移动硬盘挂载点
- `/opt`
  - 没有使用包管理程序安装的软件的位置
  - 其实通常第三方软件会装在`/usr/local`
- `/proc`
  - 内存数据，不要改，可以查看
  - `/proc/cpuinfo`保存CPU信息
  - `/proc/devices`保存设备驱动列表
  - `/proc/filesystems`保存文件系统
  - `/proc/net`保存网络协议信息
- `/sys`
  - 内存数据，不要改，可以查看
- `/net`
  - 内存数据，不要改，可以查看
- `/selinux`
  - Linux增强安全组件
  - CIA牵头开发的，用来限制root权限
- `/run`
  - 系统运行时产生的数据，如ssid、pid
  - `/var/run`是此目录的软链接
- `/srv`
  - 服务数据目录。保存一些系统服务启动之后使用的数据
- `/tmp`
  - 临时目录，所有用户都可以写文件，不能保存重要数据，建议每次开机清空此目录
- `/usr`
  - 系统软件资源目录，Unix Software Resource
- `/usr/share`
  - 应用程序的资源文件，比如文档、字体
- `/usr/src`
  - 源码包的保存位置，通常只用来保存内核源码。也可以放到`/usr/local/src`
- `/usr/src/kernels`
  - 内核源码保存位置
- `/var`
  - 动态数据，如缓存、日志文件、软件运行所产生的文件之类的随时都需要读写的数据
- `/var/www/html`
  - RPM安装的Apache的默认网页主目录
- `/var/lib`
  - 程序运行中需要调用或改变的数据保存的位置
  - 比如MySQL数据库文件默认保存在`/var/lib/mysql`中，可以直接访问文件进行备份
- `/var/log`
  - 系统日志
- `/var/spool`
  - 放置队列数据的目录，即排队等待其他程序使用的数据，比如邮件队列、打印队列
- `/var/spool/mail`
  - 系统新收到的邮件的队列
- `/var/spool/cron`
  - 系统定时任务队列

## 给服务器管理员的基础建议

- 仅适用于本地数据中心，不适用于云服务器的建议
  - 服务器只能重启，不能关机
    - 云服务器在控制台可以实现开关机
  - 服务器重启前，中止正在执行的任务，保护硬盘
    - 云服务器的硬盘维护不需要我们考虑
  - 重启时建议使用命令`shutdown -r now`，此命令会正常保存数据、中止程序。最好在重启之前执行几次`sync`命令，把内存中的数据同步到硬盘上
    - 云服务器通常建议使用控制台的重启，而不是使用服务器中的命令重启。具体因云服务提供商而异
  - 配置远程防火墙时不要把自己踢出服务器。可以配置一个定时任务，周期性把防火墙中远程连接端口打开
    - 云服务器以AWS为例，尽量使用外部防火墙（比如安全组），关闭服务器防火墙。因为使用外部防火墙在自己被踢出服务器时还可以使用云服务控制台改回来，且由云服务提供商承担负载，减小服务器压力
- 通用建议，同时适用于本地数据中心和云服务器
  - 不要在服务器访问高峰执行高负载命令。可以使用定时任务，在空闲时间（比如凌晨4点）执行高负载命令，比如解压、拷贝大文件、数据备份
  - 使用强大的密码。建议使用密钥对代替密码，能够更好地防止社会工程学攻击
  - 合理分配用户权限，遵循最小权限原则
  - 定期备份重要数据和日志
  - 70/90原则：CPU占用不应超过70%，内存占用不应超过90%，否则服务器可能死机
