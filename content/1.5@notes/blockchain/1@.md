---
title: 基础概念
description:
---

## 前言

本文是观看[此视频](https://www.bilibili.com/video/BV1NJ411D7rf)时整理的笔记

## 一些概念

- MetaMask - 浏览器插件钱包
- Jaxx - 多平台、多币种的钱包
- MyEtherWallet(MEW) - 基于 web 的钱包
- `https://etherscan.io`区块链浏览器，可以看到所有交易，以及以太币的当前价格
- `https://ethgasstation.info`查看 gas 相关信息
- Remix - 基于浏览器的 Solidity 在线编辑器
  - `remix.ethereum.org`
- Geth - 以太坊客户端（基于 go 语言）
  - 官方推荐，开发使用最多
- Parity - 以太坊客户端（基于 Rust 语言）
  - 最轻便，在历次以太坊网络攻击中表现卓越
- web3.js - 以太坊 JavaScript API 库。使用 JSON-RPC 作为通信协议
- Ganache - 以太坊客户端（创建测试环境私链）
- Truffle - 以太坊开发框架
- Solidity - 智能合约的编程语言
  - 缩写是`sol`

## 区块链（公链）简史

- 比特币（区块链 1.0）
  - 只是简单的记账
- 以太坊（区块链 2.0）
  - 去中心化 APP
- 未来
  - 思路：优化交易速度，提升吞吐量，开发者友好
  - 候选者：**EOS**、IOTA、ArcBlock

## 以太坊概述

### 定位

- 开源的、全球分布的计算基础设施
- 智能合约（smart contract）是在以太坊上执行的程序，合约可以自己发起交易
  - 以太坊是图灵完备的，比特币不是
  - 基于 gas limit 避免死循环
- 使用区块链技术进行状态同步和存储
  - 比特币仅使用区块链保存交易信息
  - 以太坊使用区块链保存交易信息和应用状态
- 使用名为以太币(ether)的加密货币作为计量和约束资源成本的货币
- 本质是基于交易的状态机(transaction-based state machine)

### 阶段

- 前沿(Frontier)，区块高度 0
  - 以太坊的初始阶段，持续时间为 2015 年 7 月 30 日-2016 年 3 月
  - 功能不完善
- 家园(Homestead)，区块高度 1150000
  - 开始可以创建去中心化 APP
- 大都会(Metropolis)，区块高度 4370000
  - 2017 年 10 月推出的“拜占庭(Byzantium)”是大都会的第一阶段
  - “君士坦丁堡(Constantinople)”是大都会的第二部分
- 宁静(Serenity)
  - 完善

以太坊曾经被攻击过一次，为了弥补损失所以进行了一次分支。老的分支被称为“以太坊-经典(ETC)”，新的分支为以太坊(ETH)

### 组成部分

- P2P 网络
  - TCP 30303
- 交易
  - 包括发送者(sender)，接收者(receiver)，值(value)，载荷(payload)
  - 每个区块包含若干个交易
- 以太坊虚拟机(EVM)
  - 一个执行字节码的程序，分布式执行智能合约
  - 类似于 Java 的 JVM
  - EVM 无法访问网络、文件系统、其他进程
  - 每个账户有一个持久化存储空间(storage)，是一个把 256 位映射到 256 位的 k/v 存储。永久保存合约状态。所以读写消耗的 gas 最大
- 数据库
  - 以太坊的区块链需要使用数据库保存在每个节点上（通常是 Google 的 LevelDB，k/v 存储），包含交易信息和系统状态
- 客户端
  - 比如 Go 语言的 Geth，或者 Parity

### 重要概念

- 账户(Account)
  - 包含地址、余额、随机数，以及可选的存储和代码
    - 外部账户/普通账户(EOA: Externally Owned Account)，没有存储和代码，可以转账或者触发合约代码
    - 内部账户/合约/合约账户(Contract)，也就是智能合约，包含存储和代码。可以给合约转账，或者调用合约的函数
      - 可以读写自己的内部存储，32 字节的 k/v 数据库
      - 可以调用其他合约代码，依次执行
  - 比特币只有地址的概念，没有账户的概念
- 地址(Address)
  - 通常表示一个 EOA 或合约，在区块链上面发送/接受交易
  - 底层是 ECDSA 公钥的 keccak hash 的最右边 160 位
- 交易(Transaction)
  - 可以发送以太币和信息
  - 向合约发送的交易可以调用合约代码，并以信息数据作为参数
  - 向不存在的地址发送交易，以太会被销毁
  - 向`0x0`地址发送合约代码，可以创建合约
  - 向`0x0`地址发送币，币会被销毁
- gas
  - 以太坊用来执行交易/智能合约的虚拟燃料
  - 普通的交易，消耗 21000 wei 的 gas
  - 交易消耗的 gas 由 EVM 执行的操作决定
  - 如果执行合约过程中，gas 耗尽，则触发 out-of-gas 异常，回滚状态
- 全节点
  - 整个主链的副本，随时验证新区块的合法性
- 轻节点
  - 不保存历史数据，仅保存当前状态，可以对区块和交易进行验证

### 以太币

- 以太坊众筹的时候，发布了 7200 万以太币
- 挖矿开始之后，主要获取以太币的方式是挖矿
  - 区块奖励(block reward)
    - 每产生一个新的区块，矿工会获得固定的以太币（原来 5 个，拜占庭上线之后现在 3 个）
    - 还会获得区块里面所有程序的 gas 花费的总和
  - 叔块奖励(uncle reward)
    - 挖出来的额外的块，没有放到主链，但是可以被后面的区块引用
    - 被引用的叔块可以获得区块奖励的约 7/8（实际是：$(叔块高度-引用叔块的区块高度+8)*普通区块奖励/8$）
  - 叔块引用奖励(uncle referencing reward)
    - 引用最多两个叔块，也可以获得奖励。是区块固定奖励的 1/32
- 每年不会发布超过 1800 万以太币
- 最小单位：`wei`
  - `1 ether = 10^18 wei`

### 幽灵协议

- GHOST: Greedy Heaviest Observed SubTree
- 以太坊的出块时间大约为 14-15 秒，设计上是 12 秒
- 快速的确认会导致区块作废率比较高，所以安全性也会降低
- 所以使用叔块的方式，不丢弃作废的块，提升安全性

### 应用

- 创建加密货币
  - 导致 2017 年各种 ICO 泛滥
- 创建域名注册系统、博彩系统
- 去中心化游戏
- ...

### 网络

- Main Network (ID=1)
  - 主网络
- Ropsten Test Network (ID=3)
  - 公共测试网络
  - 使用工作量证明共识挖矿
- Kovan Test Network (ID=42)
  - 公共测试网络
  - 使用 Aura 进行权威证明 POA 共识
  - 仅由 Parity 支持
- Rinkeby Test Network (ID=4)
  - 公共测试网络
  - 使用 Clique 协议进行权威证明 POA 共识
- Localhost 8545
  - 连接到本地节点所在的网络
- Custom RPC
  - 连接到任何兼容 geth 的 RPC 接口的节点
